
# using --dry-run | kubectl apply here to prevent fail if secrets already exist
- name: Create namespaces
  shell: '{{ orchestrator_tool }} 
    create ns {{ item }} --dry-run  -o yaml | \
    {{ orchestrator_tool }} \
    apply -f -'
  environment:
    KUBECONFIG: "{{ kubeconfig }}"
  loop:
  - backend
  - frontend
  - medical
  - operations
  - payments
- name: Create image pull secret
  shell: '{{ orchestrator_tool }} 
    create secret generic gcrcred \
    --from-file=.dockerconfigjson=files/config.json \
    --type=kubernetes.io/dockerconfigjson \
    --namespace {{ item }} --dry-run  -o yaml | \
    {{ orchestrator_tool }} \
    apply -f -'
  environment:
    KUBECONFIG: "{{ kubeconfig }}"
  loop:
  - backend
  - frontend
  - medical
  - operations
  - payments